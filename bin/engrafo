#!/usr/bin/env node

var engrafo = require("../src");
var path = require("path");
var fs = require("fs");
var program = require("commander");

program
  .version("0.0.1")
  .usage("[options] <tex file>")
  .option(
    "-o, --output <dir>",
    "Output directory (default: same as tex file)"
  )
  .option(
    "--pandoc-only",
    "Raw Pandoc output, without filters or postprocessors (for debugging)"
  )
  .parse(process.argv);

if (!process.argv.slice(2).length) {
  program.outputHelp();
  process.exit(1);
}

var texPath = program.args[0];
var outputDir = program.output ||
    (fs.lstatSync(texPath).isDirectory()
     ? texPath : path.dirname(texPath));

engrafo.render(texPath, outputDir, program.pandocOnly, (err, htmlPath) => {
  if (err) {
    console.error("Engrafo rendering failed:", err);
    process.exit(1);
  }
  console.log("ðŸ’ƒ  Document successfully rendered to", htmlPath);
  // S3 library sometimes causes Node not to quit
  process.exit(0);
});
